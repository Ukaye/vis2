<!doctype html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7" lang=""> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8" lang=""> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9" lang=""> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang=""> <!--<![endif]-->
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Loan35 Admin</title>
    <meta name="description" content="Sufee Admin - HTML5 Admin Template">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="apple-touch-icon" href="apple-icon.png">
    <link rel="shortcut icon" href="favicon.ico">

    <link rel="stylesheet" href="assets/css/normalize.css">
    <link rel="stylesheet" href="assets/css/bootstrap.min.css">
    <link href="//maxcdn.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
    <link rel="stylesheet" href="assets/css/font-awesome.min.css">
    <link rel="stylesheet" href="assets/css/themify-icons.css">
    <link rel="stylesheet" href="assets/css/flag-icon.min.css">
    <link rel="stylesheet" href="assets/css/cs-skin-elastic.css">
    <link rel="stylesheet" href="assets/css/lib/datatable/dataTables.bootstrap.min.css">
    <!-- <link rel="stylesheet" href="assets/css/bootstrap-select.less"> -->
    <link rel="stylesheet" href="assets/scss/style.css">

    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,600,700,800' rel='stylesheet' type='text/css'>
    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
    <!-- <script type="text/javascript" src="https://cdn.jsdelivr.net/html5shiv/3.7.3/html5shiv.min.js"></script> -->
    <!-- CSS to style the file input field as button and adjust the Bootstrap progress bars -->
    <link rel="stylesheet" href="css/jquery.fileupload.css">
    <link rel="stylesheet" href="css/jquery.fileupload-ui.css">
    <!-- CSS adjustments for browsers with JavaScript disabled -->
    <noscript><link rel="stylesheet" href="css/jquery.fileupload-noscript.css"></noscript>
    <noscript><link rel="stylesheet" href="css/jquery.fileupload-ui-noscript.css"></noscript>
    <style type="text/css">
        ul.nav li.active p{color: #ffffff;}
        a, a p, a h4, a:hover{color: rgb(66, 139, 202);}
        li.disabled a p, li.disabled a h4 {color: #878787;}
        li.active a h4 {color: #ffffff;}
        table{width: 100%;}
        table th{text-align: center;}
        .alert-success, .alert-success p {color: #155724;}
        .modal-dialog{
            left: 0;
        }
        .thumbnail {
            padding:0px;
        }
        .panel {
            position:relative;
        }
        .panel>.panel-heading:after,.panel>.panel-heading:before{
            position:absolute;
            top:11px;left:-16px;
            right:100%;
            width:0;
            height:0;
            display:block;
            content:" ";
            border-color:transparent;
            border-style:solid solid outset;
            pointer-events:none;
        }
        .panel>.panel-heading:after{
            border-width:7px;
            border-right-color:#f7f7f7;
            margin-top:1px;
            margin-left:2px;
        }
        .panel>.panel-heading:before{
            border-right-color:#ddd;
            border-width:8px;
        }
        select.form-control{
            height: 36px !important;
        }
        ul.timeline {
            list-style-type: none;
            position: relative;
        }
        ul.timeline:before {
            content: ' ';
            background: #d4d9df;
            display: inline-block;
            position: absolute;
            left: 29px;
            width: 2px;
            height: 100%;
            z-index: 400;
        }
        ul.timeline > li {
            margin: 20px 0;
            padding-left: 60px;
        }
        ul.timeline > li:before {
            content: ' ';
            background: white;
            display: inline-block;
            position: absolute;
            border-radius: 50%;
            border: 3px solid #22c0e8;
            left: 20px;
            width: 20px;
            height: 20px;
            z-index: 400;
        }
        ul#workflow-ul-list li{
            padding: 5px 0;
        }
        .carousel {
            margin-bottom: 0;
            padding: 0 40px 30px 40px;
        }
        .carousel-control {
            left: -12px;
            height: 40px;
            width: 40px;
            background: none repeat scroll 0 0 #222222;
            border: 4px solid #FFFFFF;
            border-radius: 23px 23px 23px 23px;
            margin-top: 90px;
        }
        .carousel-control.right {
            right: -12px;
        }
        .carousel-indicators {
            right: 50%;
            top: auto;
            bottom: -10px;
            margin-right: -19px;
        }
        .carousel-indicators li {
            background: #cecece;
        }
        .carousel-indicators .active {
            background: #428bca;
        }
    </style>
</head>
<body>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js" integrity="sha384-xBuQ/xzmlsLoJpyjoggmTEz8OWUFM0/RC5BsqQBDX2v5cMvDHcMakNTNrHIW2I5f" crossorigin="anonymous"></script>
<!-- Left Panel -->
    <script type="text/javascript">
        jQuery(document).ready(function($){ check(); });
    </script>

<aside id="left-panel" class="left-panel">
        <nav class="navbar navbar-expand-sm navbar-default">

            <div class="navbar-header">
                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#main-menu" aria-controls="main-menu" aria-expanded="false" aria-label="Toggle navigation">
                    <i class="fa fa-bars"></i>
                </button>
                <a class="navbar-brand" href="/dashboard">Loan 35</a>
                <a class="navbar-brand hidden" href="/dashboard">35</a>
            </div>

            <div id="main-menu" class="main-menu collapse navbar-collapse">
                <ul class="nav navbar-nav">
                    <li id="" class="active">
                        <a href="/dashboard"> <i class="menu-icon fa fa-dashboard"></i>Dashboard </a>
                    </li>

                    <li class="active">
                        <a href="/inspections"> <i class="menu-icon fa fa-dashboard"></i>Inspections </a>
                    </li>

                    <li class="menu-item-has-children dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"> <i class="menu-icon fa fa-table"></i>Vehicles</a>
                        <ul class="sub-menu children dropdown-menu">
                            <li><i class="fa fa-table"></i><a href="/all-vehicles">All Vehicles</a></li>
                            <li><i class="fa fa-table"></i><a href="/add-vehicle">Add Vehicles</a></li>
                        </ul>
                    </li>

                    <li id="car-models" class="menu-item-has-children dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"> <i class="menu-icon fa fa-table"></i>Car Models</a>
                        <ul class="sub-menu children dropdown-menu">
                            <li><i class="fa fa-table"></i><a href="/all-models">All Models</a></li>
                            <li><i class="fa fa-table"></i><a href="/add-model">New Model</a></li>
                        </ul>
                    </li>

                    <li class="menu-item-has-children dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"> <i class="menu-icon fa fa-table"></i>Users</a>
                        <ul class="sub-menu children dropdown-menu">
                            <li><i class="fa fa-table"></i><a href="/all-users">All Users</a></li>
                            <li id="new-user"><i class="fa fa-table"></i><a href="/add-user">New User</a></li>
                            <li><i class="fa fa-table"></i><a href="/all-applications">All Applications</a></li>
                            <li><i class="fa fa-plus"></i><a href="/add-application">New Application</a></li>
                        </ul>
                    </li>

                    <li class="menu-item-has-children dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"> <i class="menu-icon fa fa-table"></i>Reports</a>
                        <ul class="sub-menu children dropdown-menu">
                            <!-- <li><i class="fa fa-table"></i><a href="#">Maintenance Report</a></li> -->
                            <li><i class="fa fa-table"></i><a href="/reports">Valuation Reports</a></li>
                        </ul>
                    </li>

                    <li class="menu-item-has-children dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"> <i class="menu-icon fa fa-gears"></i>Settings</a>
                        <ul class="sub-menu children dropdown-menu">
                            <li><i class="fa fa-table"></i><a href="/module">Modules</a></li>
                            <li><i class="fa fa-table"></i><a href="/manage-permissions">Permissions</a></li>
                            <li class="active"><i class="fa fa-chain"></i><a href="/workflow">Workflow</a></li>
                        </ul>
                    </li>
                </ul>
            </div><!-- /.navbar-collapse -->
        </nav>
</aside><!-- /#left-panel -->
    <!-- Left Panel -->

    <!-- Right Panel -->
    <div id="right-panel" class="right-panel">
        <!-- Header-->
        <header id="header" class="header">

            <div class="header-menu">

                <div class="col-sm-7">
                    <a id="menuToggle" class="menutoggle pull-left"><i class="fa fa fa-tasks"></i></a>
                    <div class="header-left">
                        <button class="search-trigger"><i class="fa fa-search"></i></button>
                        <div class="form-inline">
                            <form class="search-form">
                                <input class="form-control mr-sm-2" type="text" placeholder="Search ..." aria-label="Search">
                                <button class="search-close" type="submit"><i class="fa fa-close"></i></button>
                            </form>
                        </div>
                    </div>
                </div>

                <div class="col-sm-5">
                    <div class="user-area dropdown float-right">
                        <strong id="user" style="margin-right:10px; vertical-align: sub"></strong>
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            <img class="user-avatar rounded-circle" src="images/admin.jpg" alt="User Avatar">
                        </a>

                        <div class="user-menu dropdown-menu">
                                <!-- <a class="nav-link" href="#"><i class="fa fa- user"></i>My Profile</a>

                                <a class="nav-link" href="#"><i class="fa fa- user"></i>Notifications <span class="count">13</span></a>

                                <a class="nav-link" href="#"><i class="fa fa -cog"></i>Settings</a> -->

                                <a class="nav-link pull-right" href="/logout"><i class="fa fa-power-off"></i> Logout</a>
                        </div>
                    </div>

                </div>
            </div>

        </header><!-- /header -->
        <!-- Header-->

        <div class="breadcrumbs">
            <div class="col-sm-4">
                <div class="page-header float-left">
                    <div class="page-title">
                        <h1>Application</h1>
                    </div>
                </div>
            </div>
            <div class="col-sm-8">
                <div class="page-header float-right">
                    <div class="page-title">
                        <ol class="breadcrumb text-right">
                            <li><a href="#">Dashboard</a></li>
                            <li><a href="#">Users</a></li>
                            <li class="active">All Applications</li>
                        </ol>
                    </div>
                </div>
            </div>
        </div>

        <div class="content mt-3">
            <div class="animated fadeIn">
                <div class="row">
                    <div class="col-md-12">
                        <div class="card">
                            <div class="card-header">
                                <strong id="workflow-div-title" class="card-title" style="float: left; margin: 15px;">Workflow</strong>
                                <div id="next-actions" class="btn-group" style="float: right;">
                                    <button type="button" class="btn btn-success btn-lg dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                        <i class="fa fa-forward"></i>
                                    </button>
                                    <div id="stage-actions" class="dropdown-menu">
                                        <a class="dropdown-item next" href="#">Save & Proceed</a>
                                        <div class="dropdown-divider"></div>
                                    </div>
                                </div>
                                <button id="current_stage" class ="btn btn-warning btn-lg" style="float: right;" disabled="disabled"></button>
                                <button class ="previous btn btn-danger btn-lg" style="float: right;"><i class="fa fa-backward"></i></button>
                                <span style="float: right; margin: 15px;">
                                    <a href="#" class="pull-right transitions-toggle">Show Transitions <i class="fa fa-chevron-down"></i></a>
                                    <a href="#" class="pull-right transitions-toggle" style="display: none;">Hide Transitions <i class="fa fa-chevron-up"></i></a>
                                </span>
                            </div>
                            <script type="text/javascript">
                                let $transitions_toggle = $('.transitions-toggle');
                                $transitions_toggle.click(function () {
                                    $('#transitions-list').toggle();
                                    $transitions_toggle.toggle();
                                });
                            </script>
                            <div class="card-body">
                                <div id="transitions-list" class="row form-group" style="display: none;">
                                    <div class="col-xs-12">
                                        <ul id="workflow-ul-list" class="nav nav-pills nav-justified thumbnail setup-panel"></ul>
                                    </div>
                                </div>
                                <div class="row setup-content" id="document-upload" style="display: none;">
                                    <div class="col-xs-12">
                                        <div class="col-md-12 well">
                                            <h3 id="document-upload-text" style="margin-bottom: 5px;"></h3>

                                            <form id="fileupload" method="POST" enctype="multipart/form-data">
                                                <div class="row fileupload-buttonbar">
                                                    <div class="col-lg-7">
                                                        <span class="btn btn-success fileinput-button">
                                                            <i class="glyphicon glyphicon-plus"></i>
                                                            <span>Add file</span>
                                                            <input type="file" name="files[]" multiple>
                                                        </span>
                                                        <button type="submit" class="btn btn-primary start">
                                                            <i class="glyphicon glyphicon-upload"></i>
                                                            <span>Start upload</span>
                                                        </button>
                                                        <button type="reset" class="btn btn-warning cancel">
                                                            <i class="glyphicon glyphicon-ban-circle"></i>
                                                            <span>Cancel upload</span>
                                                        </button>
                                                        <!--<button type="button" class="btn btn-danger delete">-->
                                                            <!--<i class="glyphicon glyphicon-trash"></i>-->
                                                            <!--<span>Delete</span>-->
                                                        <!--</button>-->
                                                        <!--<input type="checkbox" class="toggle">-->
                                                        <!-- The global file processing state -->
                                                        <span class="fileupload-process"></span>
                                                    </div>
                                                    <div class="col-lg-5 fileupload-progress fade">
                                                        <div class="progress progress-striped active" role="progressbar" aria-valuemin="0" aria-valuemax="100">
                                                            <div class="progress-bar progress-bar-success" style="width:0%;"></div>
                                                        </div>
                                                        <div class="progress-extended">&nbsp;</div>
                                                    </div>
                                                </div>
                                                <table role="presentation" class="table table-striped" style="margin: 0"><tbody class="files"></tbody></table>
                                            </form>
                                        </div>
                                        <!-- The template to display files available for upload -->
                                        <script id="template-upload" type="text/x-tmpl">
                                            {% for (var i=0, file; file=o.files[i]; i++) { %}
                                                <tr class="template-upload fade">
                                                    <td>
                                                        <span class="preview"></span>
                                                    </td>
                                                    <td>
                                                        <p class="name">{%=file.name%}</p>
                                                        <strong class="error text-danger"></strong>
                                                    </td>
                                                    <td>
                                                        <p class="size">Processing...</p>
                                                        <div class="progress progress-striped active" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0"><div class="progress-bar progress-bar-success" style="width:0%;"></div></div>
                                                    </td>
                                                    <td>
                                                        {% if (!i && !o.options.autoUpload) { %}
                                                            <button class="btn btn-primary start" disabled>
                                                                <i class="glyphicon glyphicon-upload"></i>
                                                                <span>Start</span>
                                                            </button>
                                                        {% } %}
                                                        {% if (!i) { %}
                                                            <button class="btn btn-warning cancel">
                                                                <i class="glyphicon glyphicon-ban-circle"></i>
                                                                <span>Cancel</span>
                                                            </button>
                                                        {% } %}
                                                    </td>
                                                </tr>
                                            {% } %}
                                        </script>
                                        <!-- The template to display files available for download -->
                                        <script id="template-download" type="text/x-tmpl">
                                            {% for (var i=0, file; file=o.files[i]; i++) { %}
                                                <tr class="template-download fade">
                                                    <td>
                                                        <span class="preview">
                                                            {% if (file.thumbnailUrl) { %}
                                                                <a href="{%=file.url%}" title="{%=file.name%}" download="{%=file.name%}" data-gallery><img src="{%=file.thumbnailUrl%}"></a>
                                                            {% } %}
                                                        </span>
                                                    </td>
                                                    <td>
                                                        <p class="name">
                                                            {% if (file.url) { %}
                                                                <a href="{%=file.url%}" title="{%=file.name%}" download="{%=file.name%}" {%=file.thumbnailUrl?'data-gallery':''%}>{%=file.name%}</a>
                                                            {% } else { %}
                                                                <span>{%=file.name%}</span>
                                                            {% } %}
                                                        </p>
                                                        {% if (file.error) { %}
                                                            <div><span class="label label-danger">Error</span> {%=file.error%}</div>
                                                        {% } %}
                                                    </td>
                                                    <td>
                                                        <span class="size">{%=o.formatFileSize(file.size)%}</span>
                                                    </td>
                                                    <td>
                                                       {% if (file.deleteUrl) { %}
                                                            <button class="btn btn-danger delete" data-type="{%=file.deleteType%}" data-url="{%=file.deleteUrl%}"{% if (file.deleteWithCredentials) { %} data-xhr-fields='{"withCredentials":true}'{% } %}>
                                                                <i class="glyphicon glyphicon-trash"></i>
                                                                <span>Delete</span>
                                                            </button>
                                                            <input type="checkbox" name="delete" value="1" class="toggle">
                                                       {% } else { %}
                                                            <button class="btn btn-warning cancel">
                                                                <i class="glyphicon glyphicon-ban-circle"></i>
                                                                <span>Cancel</span>
                                                            </button>
                                                       {% } %}
                                                    </td>
                                                </tr>
                                            {% } %}
                                        </script>
                                        </div>
                                    </div>
                                <div class="row setup-content" id="generate-schedule" style="display: none;">
                                    <div class="col-xs-12">
                                        <div class="col-md-12 well">
                                            <h2 class="text-center">Upload Loan Schedule</h2>
                                            <form>
                                                <fieldset>
                                                    <legend>Inputs</legend>
                                                    <label for="principal"><b>Principal:</b></label>
                                                    <input type="text" id="principal" />
                                                    <br />
                                                    <label for="interest"><b>Interest:</b></label>
                                                    <input type="text" id="interest" />
                                                    <br />
                                                    <label for="terms"><b>Terms:</b></label>
                                                    <select id="terms">
                                                        <option value="12">12 Months</option>
                                                        <option value="24">24 Months</option>
                                                        <option value="36">36 Months</option>
                                                        <option value="48">48 Months</option>
                                                        <option value="60">60 Months</option>
                                                        <option value="60">72 Months</option>
                                                    </select>
                                                    <br />
                                                    <input type="button" value="Calculate" onclick="getValues()" />
                                                </fieldset>
                                            </form>
                                            <form style="margin-bottom: 15px;">
                                                <fieldset>
                                                    <legend>Loan Repayment Schedule</legend>
                                                    <div id="Result"></div>
                                                </fieldset>
                                            </form>
                                            <button id="btn-2" class="next btn btn-primary btn-lg">Save & Proceed</button>
                                        </div>
                                    </div>
                                </div>
                                <div class="row setup-content" id="schedule">
                                    <div class="col-xs-12">
                                        <div class="col-md-12 well">
                                            <h2 class="text-center">Loan Overview</h2>
                                            <div id="Result">Loan amount: ₦200000.00<br>Interest rate: 8.00%<br>Number of months: 12<br>Monthly payment: ₦17397.69<br>Total paid: ₦208772.23<br><br><table border="1"><tbody><tr><th>Month #</th><th>Balance</th><th>Interest</th><th>Expected Payment</th></tr><tr align="center"><td>1</td><td id="balance-0">₦ 200000.00</td><td id="interest-0">₦ 1333.33</td><td>₦ <input id="payment-0" type="number" value="17397.69"></td></tr><tr align="center"><td>2</td><td id="balance-1">₦ 183935.65</td><td id="interest-1">₦ 1226.24</td><td>₦ <input id="payment-1" type="number" value="17397.69"></td></tr><tr align="center"><td>3</td><td id="balance-2">₦ 167764.20</td><td id="interest-2">₦ 1118.43</td><td>₦ <input id="payment-2" type="number" value="17397.69"></td></tr><tr align="center"><td>4</td><td id="balance-3">₦ 151484.94</td><td id="interest-3">₦ 1009.90</td><td>₦ <input id="payment-3" type="number" value="17397.69"></td></tr><tr align="center"><td>5</td><td id="balance-4">₦ 135097.16</td><td id="interest-4">₦ 900.65</td><td>₦ <input id="payment-4" type="number" value="17397.69"></td></tr><tr align="center"><td>6</td><td id="balance-5">₦ 118600.12</td><td id="interest-5">₦ 790.67</td><td>₦ <input id="payment-5" type="number" value="17397.69"></td></tr><tr align="center"><td>7</td><td id="balance-6">₦ 101993.10</td><td id="interest-6">₦ 679.95</td><td>₦ <input id="payment-6" type="number" value="17397.69"></td></tr><tr align="center"><td>8</td><td id="balance-7">₦ 85275.37</td><td id="interest-7">₦ 568.50</td><td>₦ <input id="payment-7" type="number" value="17397.69"></td></tr><tr align="center"><td>9</td><td id="balance-8">₦ 68446.18</td><td id="interest-8">₦ 456.31</td><td>₦ <input id="payment-8" type="number" value="17397.69"></td></tr><tr align="center"><td>10</td><td id="balance-9">₦ 51504.81</td><td id="interest-9">₦ 343.37</td><td>₦ <input id="payment-9" type="number" value="17397.69"></td></tr><tr align="center"><td>11</td><td id="balance-10">₦ 34450.49</td><td id="interest-10">₦ 229.67</td><td>₦ <input id="payment-10" type="number" value="17397.69"></td></tr><tr align="center"><td>12</td><td id="balance-11">₦ 17282.47</td><td id="interest-11">₦ 115.22</td><td>₦ <input id="payment-11" type="number" value="17397.69"></td></tr></tbody></table></div>
                                            <button class="btn btn-primary btn-lg">Update</button>
                                        </div>
                                    </div>
                                </div>
                                <div class="row setup-content" id="files">
                                    <div class="col-xs-12">
                                        <div class="col-md-12 well">
                                            <h2 class="text-center" style="margin-bottom: 15px;">Uploaded Documents</h2>
                                            <div id="Carousel" class="carousel slide">
                                                <ol class="carousel-indicators"></ol>

                                                <!-- Carousel items -->
                                                <div class="carousel-inner"></div>

                                                <a data-slide="prev" href="#Carousel" class="left carousel-control">‹</a>
                                                <a data-slide="next" href="#Carousel" class="right carousel-control">›</a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <script type="text/javascript">
                                    $(document).ready(function() {
                                        $('#Carousel').carousel({
                                            interval: 5000
                                        })
                                    });
                                </script>
                                <div class="row setup-content" id="denied">
                                    <div class="col-xs-12">
                                        <div class="col-md-12 well">
                                            <div class="alert alert-danger" role="alert" style="margin-top: 15px;">
                                                <h3 class="alert-heading">Loan Application has been denied!</h3>
                                                <p>Notifications would be sent to the user accounts related to this loan application to provide updates on this loan request.</p>
                                                <hr>
                                                <p class="mb-0">Please contact the admin for any related issues.</p>
                                            </div>
                                            <button id="btn-5" class="next btn btn-primary btn-lg">Save & Proceed</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-4">
                        <ul id="processes" class="timeline"></ul>
                    </div>
                    <div class="col-md-8">
                        <div class="card">
                            <div class="card-header">
                                <span style="margin: 5px;">Comments</span>
                                <button class ="btn btn-info" style="float: right;" data-toggle="modal" data-target="#addCommentModal">Add Comment <i class="fa fa-comment"></i></button>
                            </div>
                            <div class="card-body">
                                <div id="comments"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div><!-- .animated -->
    </div><!-- .content -->
<!-- Right Panel -->

    <!-- Modal -->
    <div class="modal fade" id="addCommentModal" tabindex="-1" role="dialog" aria-labelledby="addCommentModalLabel">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title" id="addCommentModalLabel">Post Comment</h4>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                </div>
                <div class="modal-body">
                    <form>
                        <div class="form-group">
                            <label class=" form-control-label">Comment</label><strong style="color:red"> *</strong><span id="comment-error" style="padding-left:50px; text-align: center"></span>
                            <div class="input-group">
                                <div class="input-group-addon"><i class="fa fa-comment"></i></div>
                                <textarea id="comment" class="form-control" required="required" maxlength="250" placeholder="Brief message"></textarea>
                            </div>
                            <small class="form-text text-muted">Maximum of 250 characters</small>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" data-dismiss="modal" onclick="comment()">Save</button>
                </div>
            </div>
        </div>
    </div>


    <script src="assets/js/popper.min.js"></script>
    <script src="assets/js/bootstrap.min.js"></script>
    <script src="assets/js/plugins.js"></script>
    <script src="assets/js/main.js"></script>


    <script src="assets/js/lib/data-table/datatables.min.js"></script>
    <script src="assets/js/lib/data-table/dataTables.bootstrap.min.js"></script>
    <script src="assets/js/lib/data-table/dataTables.buttons.min.js"></script>
    <script src="assets/js/lib/data-table/buttons.bootstrap.min.js"></script>
    <script src="assets/js/lib/data-table/jszip.min.js"></script>
    <script src="assets/js/lib/data-table/pdfmake.min.js"></script>
    <script src="assets/js/lib/data-table/vfs_fonts.js"></script>
    <script src="assets/js/lib/data-table/buttons.html5.min.js"></script>
    <script src="assets/js/lib/data-table/buttons.print.min.js"></script>
    <script src="assets/js/lib/data-table/buttons.colVis.min.js"></script>
    <script src="assets/js/lib/data-table/datatables-init.js"></script>

    <!-- The jQuery UI widget factory, can be omitted if jQuery UI is already included -->
    <script src="js/vendor/jquery.ui.widget.js"></script>
    <!-- The Templates plugin is included to render the upload/download listings -->
    <script src="https://blueimp.github.io/JavaScript-Templates/js/tmpl.min.js"></script>
    <!-- The Load Image plugin is included for the preview images and image resizing functionality -->
    <script src="https://blueimp.github.io/JavaScript-Load-Image/js/load-image.all.min.js"></script>
    <!-- The Canvas to Blob plugin is included for image resizing functionality -->
    <script src="https://blueimp.github.io/JavaScript-Canvas-to-Blob/js/canvas-to-blob.min.js"></script>
    <!-- The Iframe Transport is required for browsers without support for XHR file uploads -->
    <script src="js/jquery.iframe-transport.js"></script>
    <!-- The basic File Upload plugin -->
    <script src="js/jquery.fileupload.js"></script>
    <!-- The File Upload processing plugin -->
    <script src="js/jquery.fileupload-process.js"></script>
    <!-- The File Upload image preview & resize plugin -->
    <script src="js/jquery.fileupload-image.js"></script>
    <!-- The File Upload audio preview plugin -->
    <script src="js/jquery.fileupload-audio.js"></script>
    <!-- The File Upload video preview plugin -->
    <script src="js/jquery.fileupload-video.js"></script>
    <!-- The File Upload validation plugin -->
    <script src="js/jquery.fileupload-validate.js"></script>
    <!-- The File Upload user interface plugin -->
    <script src="js/jquery.fileupload-ui.js"></script>

    <script type="text/javascript">
        $(document).ready(function() {
            loadUsers();
            loadComments();
            loadWorkflowState();
        });

        const urlParams = new URLSearchParams(window.location.search);
        const application_id = urlParams.get('id');

        function check(){
            jQuery.ajax({
                'url': '/check',
                'type': 'get',
                'data': {},
                'success': function (data) {
                    if (data !== 1){
                        jQuery('#car-models').hide();
                        jQuery('#new-user').hide();
                        jQuery('#models-card').hide();
                        jQuery('#user').html('ATB Admin');
                    }
                    else{ jQuery('#user').html('Super Admin'); }
                },
                'error': function (err) {
                    //alert ('Error');
                    console.log('Error');
                }
            });
        }

        let workflow,
            application;

        function loadUsers(){
            $.ajax({
                'url': '/user/application-id/'+application_id,
                'type': 'get',
                'success': function (result) {
                    let data = result.response,
                        fullname = data.fullname || '',
                        file_names = Object.keys(data.files),
                        files_count = file_names.length,
                        $carousel_inner = $('.carousel-inner'),
                        $carousel_indicators = $('.carousel-indicators');

                    application = data;

                    workflow = (localStorage.getItem("workflows"))? ($.grep(JSON.parse(localStorage.getItem("workflows")), function(e){ return e.ID === data.workflowID; }))[0] : {name:'Workflow'};
                    $("#workflow-div-title").text(fullname.toUpperCase()+" ("+workflow.name+")");

                    if (files_count < 1){
                        $carousel_inner.append('<h3>No Documents Uploaded Yet!</h3>');
                    } else {
                        let count = 0,
                            pages = parseInt(files_count/4);
                        for (let i=0; i<=pages; i++){
                            if (i === 0){
                                $carousel_inner.append('<div class="item active"><div class="row page-0"></div></div>');
                                $carousel_indicators.append('<li data-target="#Carousel" data-slide-to="0" class="active"></li>');
                            } else {
                                $carousel_inner.append('<div class="item"><div class="row page-'+i+'"></div></div>');
                                $carousel_indicators.append('<li data-target="#Carousel" data-slide-to="'+i+'"></li>');
                            }
                            for (let j=0; j<4; j++){
                                if (count < files_count)
                                    $('.page-'+i).append('<div class="col-md-3"><a href="#" class="thumbnail"><img src="'+application.files[file_names[count]]+'" alt="'+file_names[count].replace(/_/g, ' ')+'" style="max-width:100%; height: 200px;"></a><p style="text-align: center;">'+file_names[count].replace(/_/g, ' ')+'</p></div>');
                                count++;
                            }
                        }
                    }
                },
                'error': function (err) {
                    console.log('Error');
                }
            });
        }

        function loadComments(comments) {
            if (comments && comments[0]){
                let $comments = $('#comments');
                $comments.html('');
                comments.forEach(function (comment) {
                    $comments.append('<div class="row">\n' +
                        '    <div class="col-sm-2">\n' +
                        '        <div class="thumbnail"><img class="img-responsive user-photo" src="https://ssl.gstatic.com/accounts/ui/avatar_2x.png"></div>\n' +
                        '    </div>\n' +
                        '    <div class="col-sm-10">\n' +
                        '        <div class="panel panel-default">\n' +
                        '            <div class="panel-heading"><strong>'+comment.fullname+'</strong> <span class="text-muted">commented on '+comment.date_created+'</span></div>\n' +
                        '            <div class="panel-body">'+comment.text+'</div>\n' +
                        '        </div>\n' +
                        '    </div>\n' +
                        '</div>');
                });
            } else {
                $.ajax({
                    'url': '/user/application/comments/'+application_id,
                    'type': 'get',
                    'success': function (data) {
                        let comments = data.response,
                            $comments = $('#comments');
                        $comments.html('');
                        if (!comments[0])
                            return $comments.append('<h2 style="margin: auto;">No comments available yet!</h2>');
                        comments.forEach(function (comment) {
                            $comments.append('<div class="row">\n' +
                                '    <div class="col-sm-2">\n' +
                                '        <div class="thumbnail"><img class="img-responsive user-photo" src="https://ssl.gstatic.com/accounts/ui/avatar_2x.png"></div>\n' +
                                '    </div>\n' +
                                '    <div class="col-sm-10">\n' +
                                '        <div class="panel panel-default">\n' +
                                '            <div class="panel-heading"><strong>'+comment.fullname+'</strong> <span class="text-muted">commented on '+comment.date_created+'</span></div>\n' +
                                '            <div class="panel-body">'+comment.text+'</div>\n' +
                                '        </div>\n' +
                                '    </div>\n' +
                                '</div>');
                        });
                    },
                    'error': function (err) {
                        console.log('Error');
                        swal('No internet connection');
                    }
                });
            }
        }

        let stage_document = false;
        $('.next').hide();
        $('.previous').hide();
        $('#next-actions').hide();
        $('#current_stage').hide();
        function loadWorkflowStages(state) {
            $.ajax({
                'url': '/workflow-stages/'+state.workflowID,
                'type': 'get',
                'success': function (data) {
                    $('.next').show();
                    $('.previous').show();
                    $('#next-actions').show();
                    $('#current_stage').show();

                    let count = 0,
                        workflow_stages = data.response,
                        ul = document.getElementById('workflow-ul-list'),
                        $last_btn = $("#btn-"+workflow_stages[workflow_stages.length-1]['stageID']),
                        stage = ($.grep(workflow_stages, function(e){ return e.stageID === state.current_stage; }))[0];

                    $last_btn.hide();
                    $('#current_stage').text(stage.name);
                    if (stage.stage_name === 'Application Started'){
                        $('#schedule').hide();
                        $('#generate-schedule').show();
                    }
                    if (stage.document){
                        $('#document-upload').show();
                        $('#document-upload-text').text('Kindly upload a '+stage.document);
                        stage_document = stage.document;
                        fileUpload(stage);
                    }

                    if (stage.actions){
                        let actions = stage.actions.split(',');
                        actions.forEach(function (code) {
                            let stage_template = ($.grep(workflow_stages, function(e){ return e.code === code; }))[0];
                            $('#stage-actions').append('<a href="#" class="dropdown-item" id="stage-action-'+stage_template.stageID+'">'
                                +stage_template.name+' ('+stage_template.stage_name+')</a>');
                        });
                    }

                    $("#stage-actions").on('click', function (e) {
                        let id = (e.target.id.split('-'))[2];
                        nextStage(state, workflow_stages, id);
                    });

                    workflow_stages.forEach(function (stage) {
                        if (stage.stage_name !== 'Denied'){
                            let index =  workflow_stages.map(function(e) { return e.stageID; }).indexOf(state.current_stage),
                                li = document.createElement('li');
                            if (count === index){
                                li.className = "active";
                                if (count === 0)
                                    $(".previous").hide();
                                if (count === workflow_stages.length-1)
                                    $(".next").hide();
                            } else if (count > index) {
                                li.className = "disabled";
                            }
                            ul.appendChild(li);
                            count++;
                            li.innerHTML += '<a><h4 class="list-group-item-heading">Step '+count+'</h4>\n' +
                                '<p class="list-group-item-text">'+stage.name+'<br> ('+stage.stage_name+')</p></a>';
                        }
                    });

                    if (stage.stage_name === 'Denied'){
                        $("#current_stage").hide();
                        $("#next-actions").hide();
                        $(".previous").hide();
                        $("#schedule").hide();
                        $("#denied").show();
                        $("#files").hide();
                        $(".next").hide();

                        let li = document.createElement('li');
                        li.className = "active";
                        ul.appendChild(li);
                        li.innerHTML += '<a><h4 class="list-group-item-heading">Step '+(count+1)+'</h4>\n' +
                            '<p class="list-group-item-text">'+stage.name+'<br> ('+stage.stage_name+')</p></a>';
                    }

                    loadAllWorkflowState(workflow_stages);
                },
                'error': function (err) {
                    console.log('Error');
                    swal('No internet connection');
                }
            });
        }

        function loadWorkflowState() {
            $.ajax({
                'url': '/user/workflow_process/'+application_id,
                'type': 'get',
                'success': function (data) {
                    let states = data.response,
                        state = states[states.length-1],
                        allWells = $('.setup-content');

                    loadWorkflowStages(state);
                    allWells.hide();

                    $('.next').on('click', function(e) {
                        nextStage(state);
                    });

                    $('.previous').on('click', function(e) {
                        previousStage(state,states);
                    });

                    $('#schedule').show();
                    $('#files').show();
                },
                'error': function (err) {
                    console.log('Error');
                    swal('No internet connection');
                }
            });
        }

        function loadAllWorkflowState(workflow_stages) {
            $.ajax({
                'url': '/user/workflow_process_all/'+application_id,
                'type': 'get',
                'success': function (data) {
                    let states = data.response,
                        $processes = $('#processes');

                    $processes.html('');
                    if (!states[0])
                        return $processes.append('<h3 style="margin: auto;">No transitions available yet!</h3>');
                    states.forEach(function (state) {
                        let previous_stage = ($.grep(workflow_stages, function(e){ return e.stageID === state.previous_stage; }))[0] || {stage_name:'N/A'},
                            current_stage = ($.grep(workflow_stages, function(e){ return e.stageID === state.current_stage; }))[0] || {stage_name:''};
                        $processes.append('<li>\n' +
                            '    <p><a href="#">'+current_stage.stage_name+'</a></p>\n' +
                            '    <p><a href="#">'+state.date_created+'</a></p>\n' +
                            '    <p>Moved from '+previous_stage.stage_name+' to '+current_stage.stage_name+'</p>\n' +
                            '</li>');
                    });
                },
                'error': function (err) {
                    console.log('Error');
                    swal('No internet connection');
                }
            });
        }

        function nextStage(state, workflow_stages, action_stage) {
            let stage = {};
            if (workflow_stages && action_stage){
                stage.previous_stage = workflow_stages.map(function(e) { return e.stageID; }).indexOf(state.current_stage);
                stage.current_stage = action_stage;
            }
            if (stage_document && !(stage_document.replace(/ /g, '_') in application.files))
                return swal('Kindly upload required document ('+stage_document+')');
            $.ajax({
                'url': '/user/workflow_process/'+application_id+'/'+state.workflowID,
                'type': 'post',
                'data': {stage: stage},
                'success': function (data) {
                    if (data.status === 200){
                        $('#document-upload').hide();
                        $('#document-upload-text').text('');
                        swal('Workflow updated successfully!');
                        window.location.reload();
                    } else {
                        if (data.message){
                            swal(data.message);
                        } else {
                            swal('No internet connection');
                        }
                    }
                },
                'error': function (err) {
                    console.log('Error');
                    swal('No internet connection');
                }
            });
        }

        function previousStage(state,states) {
            $.ajax({
                'url': '/user/revert_workflow_process/'+application_id,
                'type': 'get',
                'success': function (data) {
                    if (data.status === 200){
                        $('#document-upload').hide();
                        $('#document-upload-text').text('');
                        swal('Workflow updated successfully!');
                        window.location.reload();
                    } else {
                        if (data.message){
                            swal(data.message);
                        } else {
                            swal('No internet connection');
                        }
                    }
                },
                'error': function (err) {
                    console.log('Error');
                    swal('No internet connection');
                }
            });
        }

        function comment(){
            let $comment = $("#comment"),
                comment = $comment.val();
            if (!comment || comment === ""){
                $comment.val("");
                return swal('Kindly type a brief comment');
            }
            $.ajax({
                'url': '/user/application/comments/'+application_id,
                'type': 'post',
                'data': {text: comment},
                'success': function (data) {
                    let comments = data.response;
                    results = comments;
                    loadComments(comments);
                    $comment.val("");
                    swal('Comment saved successfully');
                },
                'error': function (err) {
                    $comment.val("");
                    swal('Oops! An error occurred while saving comment');
                }
            });
        }

        function fileUpload(stage) {
            let $fileupload = $('#fileupload'),
                stage_document_name = stage.document.replace(/ /g, '_');

            $fileupload.fileupload({
                url: 'document-upload/'+application_id+'/'+stage_document_name,
                disableImageResize: /Android(?!.*Chrome)|Opera/
                    .test(window.navigator.userAgent),
                maxFileSize: 999000,
                acceptFileTypes: /(\.|\/)(gif|jpe?g|png)$/i
            });

            $fileupload.addClass('fileupload-processing');
            $.ajax({
                url: $fileupload.fileupload('option', 'url'),
                context: $fileupload[0]
            }).always(function () {
                $(this).removeClass('fileupload-processing');
            }).done(function (result) {
                $(this).fileupload('option', 'done')
                    .call(this, $.Event('done'), {result: result});
            });
        }

        /**
         * @author Joel Nutt
         * ITEC136-V1WW(FA11) - Franklin U.
         * David Crossmier - Instructor
         * Assigment 8-3 (HW07)
         * 11/06/2011
         *
         */

        function getValues()
        {
            //button click gets values from inputs
            var balance = parseFloat(document.getElementById("principal").value);
            var interestRate =
                parseFloat(document.getElementById("interest").value/100.0);
            var terms = parseInt(document.getElementById("terms").value);

            //set the div string
            var div = document.getElementById("Result");

            //in case of a re-calc, clear out the div!
            div.innerHTML = "";

            //validate inputs - display error if invalid, otherwise, display table
            var balVal = validateInputs(balance);
            var intrVal = validateInputs(interestRate);

            if (balVal && intrVal)
            {
                //Returns div string if inputs are valid
                div.innerHTML += amort(balance, interestRate, terms);
            }
            else
            {
                //returns error if inputs are invalid
                div.innerHTML += "Please Check your inputs and retry - invalid values.";
            }
        }

        /**
         * Amort function:
         * Calculates the necessary elements of the loan using the supplied user input
         * and then displays each months updated amortization schedule on the page
         */
        function amort(balance, interestRate, terms)
        {
            //Calculate the per month interest rate
            var monthlyRate = interestRate/12;
            //Calculate the payment
            var payment = balance * (monthlyRate/(1-Math.pow(
                1+monthlyRate, -terms)));
            //begin building the return string for the display of the amort table
            var result = "Loan amount: ₦" + balance.toFixed(2) +  "<br />" +
                "Interest rate: " + (interestRate*100).toFixed(2) +  "%<br />" +
                "Number of months: " + terms + "<br />" +
                "Monthly payment: ₦" + payment.toFixed(2) + "<br />" +
                "Total paid: ₦" + (payment * terms).toFixed(2) + "<br /><br />";

            //add header row for table to return string
            result += "<table border='1'><tr><th>Month #</th><th>Balance</th>" +
                "<th>Interest</th><th>Expected Payment</th>";

            /**
             * Loop that calculates the monthly Loan amortization amounts then adds
             * them to the return string
             */
            for (var count = 0; count < terms; ++count)
            {
                //in-loop interest amount holder
                var interest = 0;
                //in-loop monthly principal amount holder
                var monthlyPrincipal = 0;
                //start a new table row on each loop iteration
                result += "<tr align=center>";
                //display the month number in col 1 using the loop count variable
                result += "<td>" + (count + 1) + "</td>";
                //code for displaying in loop balance
                result += "<td id='balance-"+count+"'>₦ " + balance.toFixed(2) + "</td>";
                //calc the in-loop interest amount and display
                interest = balance * monthlyRate;
                result += "<td id='interest-"+count+"'>₦ " + interest.toFixed(2) + "</td>";
                //calc the in-loop monthly principal and display
                monthlyPrincipal = payment;
                result += "<td>₦ <input id='payment-"+count+"' type='number' value='" + monthlyPrincipal.toFixed(2) + "' /></td>";
                //end the table row on each iteration of the loop
                result += "</tr>";
                //update the balance for each loop iteration
                balance = balance - monthlyPrincipal + interest;

                $(document.body).delegate('#payment-'+count,'change', function(e) {
                    for (let i=0; i<terms; i++){
                        let id = i,
                            payment = $('#payment-'+id).val(),
                            previous_balance = parseFloat(($('#balance-'+id).html().split(" "))[1]),
                            previous_interest = parseFloat(($('#interest-'+id).html().split(" "))[1]),
                            new_balance = previous_balance-payment+previous_interest;
                        $('#balance-'+(id+1)).text("₦ " + new_balance.toFixed(2));
                    }
                });
            }

            //Final piece added to return string before returning it - closes the table
            result += "</table>";
            //returns the concatenated string to the page
            return result;
        }

        function validateInputs(value)
        {
            //some code here to validate inputs
            if ((value == null) || (value == ""))
            {
                return false;
            }
            else
            {
                return true;
            }
        }
    </script>
</body>
</html>
